<div class="container my-4 p-4 rounded shadow bg-white position-relative" style="max-width: 600px;">
  <!-- Close Button -->
  <button (click)="onClose()" class="btn position-absolute top-0 end-0 m-3 p-0" style="background: none; border: none;">
    <span style="font-size: 1.5rem; color: #888;">&times;</span>
  </button>

  <!-- Heading -->
  <h4 class="text-center fw-bold mb-4" style="color: #ff6b00;">Your Order Summary</h4>

  <!-- Empty Cart Message -->
  <div *ngIf="cartItems.length === 0" class="text-center py-5 text-muted">
    <p>Your cart is empty.</p>
  </div>

  <!-- Cart Items -->
  <div *ngIf="cartItems.length > 0" class="cart-items">
    <div *ngFor="let item of cartItems" class="d-flex justify-content-between align-items-start border-bottom py-3">
      <!-- Item Info -->
      <div class="d-flex align-items-center">
        <div class="ms-1">
          <h6 class="mb-0 fw-semibold">{{ item.name }}</h6>
        </div>
      </div>

      <!-- Quantity & Price -->
      <div class="text-end">
        <div class="d-flex justify-content-end align-items-center mb-1">
          <div class="d-flex align-items-center border rounded px-2 py-1" style="gap: 0.5rem;">
            <button (click)="decreaseQty(item)" class="btn btn-outline-orange btn-sm px-2 py-0 border-0">‚àí</button>
            <span class="fw-medium">{{ item.quantity }}</span>
            <button (click)="increaseQty(item)" class="btn btn-outline-orange btn-sm px-2 py-0 border-0">+</button>
          </div>
        </div>
        <div class="text-muted fw-semibold">
          ‚Çπ{{ (item.price * item.quantity) || 0 }}
        </div>
      </div>
    </div>

    <!-- Subtotal -->
    <div class="d-flex justify-content-between align-items-center mt-4 p-3 rounded" style="background-color: #fff5f0;">
      <div>
        <h6 class="mb-1 text-muted">SUBTOTAL</h6>
        <h5 class="fw-bold mb-0">‚Çπ{{ totalPrice }}</h5>
        <small class="text-muted" style="font-size: 12px;">*Extra charges may apply</small>
      </div>
      <button (click)="openOtpStep()" class="btn fw-semibold"
        style="background-color: #fff; color: #ff6b00; border: 1px solid #ff6b00;">
        Place Order
      </button>
    </div>

    <!-- Order More Button -->
    <!-- <div class="text-center mt-3">
      <button routerLink="/menu" class="btn btn-link text-decoration-none text-muted fw-medium">
        ‚Üê Order More Items
      </button>
    </div> -->

    <!-- Order More Button -->
    <div class="text-center mt-3">
      <button routerLink="/menu" class="btn fw-semibold px-4 py-2"
        style="background-color: #fff5f0; color: #ff6b00; border: 1px solid #ff6a0085; border-radius: 0.5rem;">
        ‚Üê Order More Items
      </button>
    </div>

  </div>
</div>

<!-- OTP Modal -->
<div class="modal fade" id="otpModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content otp-modal-content p-3">
      <div class="modal-header border-0">
        <h5 class="modal-title">Customer Verification</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">

        <!-- Step 1: Name + Phone Input -->
        <div *ngIf="!otpSent">
          <label class="form-label">Name</label>
          <input [(ngModel)]="userName" class="form-control mb-1" type="text" placeholder="Enter your name" />
          <div *ngIf="nameError" class="text-danger small mb-2">{{ nameError }}</div>

          <label class="form-label">Mobile Number</label>
          <input [(ngModel)]="mobileNumber" class="form-control mb-1" type="text" placeholder="Mobile Number" />
          <div *ngIf="mobileError" class="text-danger small mb-2">{{ mobileError }}</div>

          <button class="btn btn-orange w-100 mt-2" (click)="sendOtp()">Send OTP</button>
        </div>
        <!-- Step 2: OTP Verification -->
        <div *ngIf="otpSent && !isVerified">
          <div *ngIf="otpMessageVisible" class="alert alert-success p-2 d-flex align-items-center mb-3"
            style="background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;">
            ‚úÖ OTP sent to {{ mobileNumber }}
          </div>

          <!-- OTP Input -->
          <label class="form-label">Enter OTP</label>
          <input [(ngModel)]="otp" class="form-control mb-2" type="text" placeholder="Enter OTP" />

          <!-- üî¥ Error Message in red -->
          <div *ngIf="otpErrorMessage" class="text-danger mb-2" style="font-size: 14px;">
            {{ otpErrorMessage }}
          </div>

          <button class="btn w-100 mt-2" [ngClass]="showResend ? 'btn-orange' : 'btn-success'"
            (click)="showResend ? resendOtp() : verifyOtp()">
            {{ showResend ? 'Resend OTP' : 'Verify OTP' }}
          </button>

          <!-- Countdown Timer -->
          <div class="text-center text-muted mt-2" *ngIf="!showResend">
            Resend OTP in {{ countdown < 10 ? '0' + countdown : countdown }}s </div>
          </div>
          <!-- ‚úÖ Success after verification -->
          <div *ngIf="isVerified" class="alert alert-success mt-3 text-center">
            Order Placed Successfully!
          </div>
        </div>
      </div>
    </div>
  </div>